<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kevin‚Äôs Christmas Luggage Panic!</title>
    <style>
        /* ... (–≤–∞—à CSS –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', cursive, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0a5f20, #c41e3a, #ffffff);
            height: 100vh;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.6);
        }
        
        #gameContainer {
            position: relative;
            width: 800px;
            height: 600px;
            background: rgba(0, 30, 10, 0.75);
            border: 4px solid #c41e3a;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
        }
        
        #gameCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #uiOverlay {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }
        
        .score-display, .lives-display {
            background: rgba(196, 30, 58, 0.8);
            padding: 10px 20px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            backdrop-filter: blur(5px);
            border: 2px solid white;
            color: white;
        }
        
        #soundToggle {
            position: absolute;
            top: 70px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
            font-size: 20px;
            border: 2px solid white;
            transition: transform 0.2s;
        }
        #soundToggle:hover {
            transform: scale(1.1);
        }
        #soundToggle.muted {
            opacity: 0.5;
        }
        
        #quizModal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #c41e3a, #0a5f20);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            z-index: 20;
            display: none;
            min-width: 500px;
            border: 3px solid #ffd700;
        }
        
        #quizQuestion {
            font-size: 22px;
            margin-bottom: 20px;
            line-height: 1.4;
            color: white;
        }
        
        .quiz-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }
        
        .quiz-option {
            background: white;
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            color: #c41e3a;
            font-weight: bold;
            border: 2px solid #0a5f20;
        }
        
        .quiz-option:hover {
            transform: scale(1.03);
            background: #f0f0f0;
            border-color: #c41e3a;
        }
        
        #gameOverScreen, #victoryScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 30;
            display: none;
        }
        
        #gameOverText, #victoryText {
            font-size: 48px;
            margin-bottom: 30px;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            color: #ffd700;
        }
        
        #restartButton {
            background: linear-gradient(135deg, #0a5f20, #c41e3a);
            color: white;
            border: 3px solid #ffd700;
            padding: 15px 40px;
            font-size: 24px;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.3s ease;
            font-weight: bold;
        }
        
        #restartButton:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        #confetti {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 25;
            display: none;
        }
        
        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -20px;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        
        <div id="uiOverlay">
            <div class="score-display">Score: <span id="score">0</span></div>
            <div class="lives-display">Lives: <span id="lives">3</span></div>
        </div>
        
        <div id="soundToggle">üîä</div>
        
        <div id="quizModal">
            <div id="quizQuestion"></div>
            <div class="quiz-options" id="quizOptions"></div>
        </div>
        
        <div id="gameOverScreen">
            <div id="gameOverText">Game Over!</div>
            <button id="restartButton">Play Again</button>
        </div>
        
        <div id="victoryScreen">
            <div id="victoryText">üéâ Congratulations! üéâ<br>You Win!</div>
            <button id="restartButton">Play Again</button>
        </div>
        
        <div id="confetti"></div>
    </div>

    <script>
        // ==========================
        // üîä –ó–í–£–ö–û–í–´–ï –§–ê–ô–õ–´
        // ==========================
        const soundFiles = {
            background: 'sounds/background_music1.mp3',
            catchCorrect: 'sounds/catch.mp3',
            loseLife: 'sounds/error.mp3',
            quiz: 'sounds/bell.mp3',
            win: 'sounds/win.mp3',
            gameOver: 'sounds/gameover.mp3'
        };

        // ==========================
        // üîä –°–û–°–¢–û–Ø–ù–ò–ï –ó–í–£–ö–ê
        // ==========================
        let soundsLoaded = false;
        let soundEnabled = true;
        const sounds = {};
        let backgroundMusic = null;

        function initAudio() {
            if (soundsLoaded) return;

            backgroundMusic = new Audio(soundFiles.background);
            backgroundMusic.loop = true;
            backgroundMusic.volume = 0.3;

            sounds.catchCorrect = new Audio(soundFiles.catchCorrect);
            sounds.loseLife = new Audio(soundFiles.loseLife);
            sounds.quiz = new Audio(soundFiles.quiz);
            sounds.win = new Audio(soundFiles.win);
            sounds.gameOver = new Audio(soundFiles.gameOver);

            Object.values(sounds).forEach(s => s.volume = 0.6);
            soundsLoaded = true;
            updateSoundIcon();
            if (soundEnabled) startBackgroundMusic();
        }

        function playSound(name) {
            if (!soundsLoaded || !soundEnabled) return;
            if (sounds[name]) {
                sounds[name].currentTime = 0;
                sounds[name].play().catch(() => {});
            }
        }

        function startBackgroundMusic() {
            if (backgroundMusic && soundEnabled) {
                backgroundMusic.play().catch(() => {});
            }
        }

        function stopBackgroundMusic() {
            if (backgroundMusic) {
                backgroundMusic.pause();
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            updateSoundIcon();
            if (soundEnabled) {
                startBackgroundMusic();
            } else {
                stopBackgroundMusic();
            }
            localStorage.setItem('soundEnabled', soundEnabled);
        }

        function updateSoundIcon() {
            const icon = document.getElementById('soundToggle');
            if (!icon) return;
            icon.textContent = soundEnabled ? 'üîä' : 'üîá';
            icon.classList.toggle('muted', !soundEnabled);
        }

        function loadSoundSettings() {
            const saved = localStorage.getItem('soundEnabled');
            if (saved !== null) {
                soundEnabled = saved === 'true';
            }
        }

        // ==========================
        // üéÅ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø
        // ==========================
        const ITEM_IMAGES = {
            correct: [
                'images/treetoy.png',
                'images/gift.png',
                'images/stocking.png',
                'images/gingerbread.png',
                'images/santa_hat.png',
                'images/star.png',
                'images/mistletoe.png'
            ],
            incorrect: [
                'images/pizza.png',
                'images/sock.png',
                'images/ball.png',
                'images/beach_hat.png',
                'images/crown.png',
                'images/wrapping_paper.png',
                'images/flowers.png'
            ]
        };

        const basketImage = new Image();
        basketImage.src = 'images/box1.png';

        const background = new Image();
        background.src = 'images/fone1.png';

        const quizQuestions = [
            { question: "In the UK, some families eat roast turkey for Christmas dinner‚Ä¶ and sometimes for breakfast the next day too!", correct: "true" },
            { question: "Santa Claus always enters houses through the front door.", correct: "false" },
            { question: "In the US, it‚Äôs common to put an avocado in your Christmas stocking as a symbol of good luck.", correct: "false" },
            { question: "People in Australia often celebrate Christmas with a beach barbecue.", correct: "true" },
            { question: "‚ÄúJingle Bells‚Äù was originally written as a Halloween song.", correct: "false" },
            { question: "In some British families, it‚Äôs tradition to watch the King‚Äôs Christmas Speech on TV.", correct: "true" },
            { question: "All American kids believe that Rudolph the Red-Nosed Reindeer is real.", correct: "false" },
            { question: "It‚Äôs illegal to eat mince pies on Christmas Day in England.", correct: "false" },
            { question: "In Canada, Santa has his own postal code: H0H 0H0.", correct: "true" },
            { question: "British people hang real herring on the Christmas tree for good luck.", correct: "false" },
            { question: "‚ÄúAuld Lang Syne‚Äù is sung on Christmas Eve in the US.", correct: "false" },
            { question: "Some families in the US leave carrots for Santa‚Äôs reindeer ‚Äî not for Santa himself.", correct: "true" },
            { question: "In the UK, it‚Äôs bad luck to eat pudding before Christmas Day.", correct: "false" },
            { question: "Elves work in Santa‚Äôs workshop all year round ‚Äî except on February 29th (leap day).", correct: "false" },
            { question: "In New York, people give gifts to strangers under the Rockefeller Christmas Tree.", correct: "false" },
            { question: "Christmas crackers often contain a tiny plastic toy and a joke.", correct: "true" },
            { question: "Americans always open presents on December 24th.", correct: "false" },
            { question: "It‚Äôs traditional to wear a new pair of socks on New Year‚Äôs Eve in Canada for good luck.", correct: "false" },
            { question: "In the song ‚ÄúThe Twelve Days of Christmas‚Äù, the gift on the 5th day is ‚Äúfive golden onions‚Äù.", correct: "false" },
            { question: "Some British kids write letters to Santa‚Ä¶ and then burn them so the smoke carries the message to the North Pole.", correct: "false" }
        ];

        // ==========================
        // üß† –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // ==========================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800;
        canvas.height = 600;

        let score = 0;
        let lives = 3;
        let gameRunning = true;
        let nextQuizScore = 5;
        let currentQuizIndex = 0;
        let fallingItems = [];

        const basket = {
            x: canvas.width / 2 - 50,
            y: canvas.height - 60,
            width: 100,
            height: 40
        };

        function init() {
            score = 0;
            lives = 3;
            gameRunning = true;
            nextQuizScore = 5;
            currentQuizIndex = 0;
            fallingItems = [];
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('victoryScreen').style.display = 'none';
            document.getElementById('quizModal').style.display = 'none';
            document.getElementById('confetti').style.display = 'none';
            
            if (soundsLoaded && soundEnabled) {
                startBackgroundMusic();
            }
        }

        function createFallingItem() {
            if (!gameRunning) return;
            const isCorrect = Math.random() < 0.7;
            const imageList = isCorrect ? ITEM_IMAGES.correct : ITEM_IMAGES.incorrect;
            const randomImage = imageList[Math.floor(Math.random() * imageList.length)];
            fallingItems.push({
                x: Math.random() * (canvas.width - 60),
                y: -60,
                width: 50,
                height: 50,
                image: randomImage,
                isCorrect: isCorrect,
                speed: 1.5 + Math.random() * 1.0
            });
        }

        function drawBasket() {
            if (basketImage.complete && basketImage.naturalHeight !== 0) {
                ctx.drawImage(basketImage, basket.x, basket.y, basket.width, basket.height);
            } else {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(basket.x, basket.y, basket.width, basket.height);
                ctx.fillStyle = '#DEB887';
                ctx.fillRect(basket.x + 10, basket.y - 10, basket.width - 20, 10);
            }
        }

        function drawFallingItems() {
            fallingItems.forEach(item => {
                const img = new Image();
                img.src = item.image;
                if (img.complete && img.naturalHeight !== 0) {
                    ctx.drawImage(img, item.x, item.y, item.width, item.height);
                } else {
                    ctx.fillStyle = item.isCorrect ? '#4CAF50' : '#F44336';
                    ctx.fillRect(item.x, item.y, item.width, item.height);
                }
            });
        }

        function update() {
            if (!gameRunning) return;

            for (let i = fallingItems.length - 1; i >= 0; i--) {
                const item = fallingItems[i];
                item.y += item.speed;

                if (item.y + item.height >= basket.y &&
                    item.x + item.width > basket.x &&
                    item.x < basket.x + basket.width) {

                    fallingItems.splice(i, 1);

                    if (item.isCorrect) {
                        score += 1;
                        document.getElementById('score').textContent = score;
                        playSound('catchCorrect');

                        if (score >= nextQuizScore && score % 5 === 0) {
                            showQuiz();
                        }
                        if (score >= 50) {
                            showVictory();
                        }
                    } else {
                        lives -= 1;
                        document.getElementById('lives').textContent = lives;
                        playSound('loseLife');
                        if (lives <= 0) gameOver();
                    }
                }
                else if (item.y > canvas.height) {
                    fallingItems.splice(i, 1);
                    if (item.isCorrect) {
                        lives -= 1;
                        document.getElementById('lives').textContent = lives;
                        playSound('loseLife');
                        if (lives <= 0) gameOver();
                    }
                }
            }
        }

        function render() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (background.complete && background.naturalHeight !== 0) {
                ctx.drawImage(background, 0, 0, canvas.width, canvas.height);
            } else {
                const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                gradient.addColorStop(0, '#0a5f20');
                gradient.addColorStop(1, '#c41e3a');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            drawBasket();
            drawFallingItems();
        }

        function showQuiz() {
            gameRunning = false;
            const modal = document.getElementById('quizModal');
            modal.style.display = 'block';
            playSound('quiz');

            const q = quizQuestions[currentQuizIndex % quizQuestions.length];
            document.getElementById('quizQuestion').textContent = q.question;

            const container = document.getElementById('quizOptions');
            container.innerHTML = '';

            ['true', 'false'].forEach(option => {
                const btn = document.createElement('div');
                btn.className = 'quiz-option';
                btn.textContent = option.charAt(0).toUpperCase() + option.slice(1);
                btn.onclick = () => handleQuizAnswer(option === q.correct);
                container.appendChild(btn);
            });

            currentQuizIndex++;
        }

        function handleQuizAnswer(isCorrect) {
            document.getElementById('quizModal').style.display = 'none';
            gameRunning = true;

            if (!isCorrect) {
                score = Math.max(0, score - 5);
                document.getElementById('score').textContent = score;
                playSound('loseLife');
            }

            nextQuizScore = score + 5;
        }

        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: —Ñ—É–Ω–∫—Ü–∏—è gameOver() ‚Äî –æ–¥–Ω–∞, —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è
        function gameOver() {
            gameRunning = false;
            stopBackgroundMusic();
            playSound('gameOver');
            document.getElementById('gameOverScreen').style.display = 'block';
            
            // >>>>>>>>>>>>>> –û–¢–ü–†–ê–í–õ–Ø–ï–ú –°–û–û–ë–©–ï–ù–ò–ï –í –†–û–î–ò–¢–ï–õ–¨–°–ö–£–Æ –ò–ì–†–£ <<<<<<<<<<<<
            window.parent.postMessage({ game: 'game1', result: 'lose' }, '*');
        }

        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: —Ñ—É–Ω–∫—Ü–∏—è showVictory() ‚Äî –æ–¥–Ω–∞, —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏—è
        function showVictory() {
            gameRunning = false;
            stopBackgroundMusic();
            playSound('win');
            document.getElementById('victoryScreen').style.display = 'block';
            createConfetti();
            document.getElementById('confetti').style.display = 'block';
            
            // >>>>>>>>>>>>>> –û–¢–ü–†–ê–í–õ–Ø–ï–ú –°–û–û–ë–©–ï–ù–ò–ï –í –†–û–î–ò–¢–ï–õ–¨–°–ö–£–Æ –ò–ì–†–£ <<<<<<<<<<<<
            window.parent.postMessage({ game: 'game1', result: 'win' }, '*');
        }

        function createConfetti() {
            const cont = document.getElementById('confetti');
            cont.innerHTML = '';
            for (let i = 0; i < 150; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
                piece.style.width = Math.random() * 10 + 5 + 'px';
                piece.style.height = Math.random() * 10 + 5 + 'px';
                piece.style.animation = `fall ${Math.random() * 3 + 2}s linear forwards`;
                cont.appendChild(piece);
            }
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    to {
                        transform: translateY(600px) rotate(${Math.random() * 360}deg);
                        opacity: 0;
                    }
                }
            `;
            document.head.appendChild(style);
        }

        function activateAudio() {
            if (!soundsLoaded) {
                initAudio();
            }
        }

        document.addEventListener('keydown', (e) => {
            activateAudio();
            if (!gameRunning) return;
            if (e.key === 'ArrowLeft') basket.x = Math.max(0, basket.x - 20);
            else if (e.key === 'ArrowRight') basket.x = Math.min(canvas.width - basket.width, basket.x + 20);
        });

        canvas.addEventListener('mousemove', (e) => {
            activateAudio();
            if (!gameRunning) return;
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            basket.x = Math.max(0, Math.min(canvas.width - basket.width, mouseX - basket.width / 2));
        });

        document.getElementById('soundToggle').addEventListener('click', (e) => {
            e.stopPropagation();
            toggleSound();
        });

        document.getElementById('restartButton').addEventListener('click', () => {
            activateAudio();
            init();
        });

        loadSoundSettings();
        updateSoundIcon();

        init();
        function gameLoop() {
            update();
            render();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();

        setInterval(() => {
            if (gameRunning) createFallingItem();
        }, 1500);
    </script>
</body>
</html>
